---
title: "Login through Unified Identity Authentication System of Southeast University Using Python Web Crawler"
excerpt: "Short description of portfolio item number 1<br/><img src='/images/500x300.png'>"
collection: portfolio
---

## Manually login and check the network log

1. Manually login the Unified Identity Authentication System.
   ![image-20210723213938332](/images/seu-login.assets/image-20210723213938332.png)

2. Press F12 in Chromium based browser (Chrome, Edge, ...), check the network log. Remember to click the "Preserve log" button to avoid losing logs due to redirection.![image-20210723214049858](/images/seu-login.assets/image-20210723214049858.png)

3. By checking the log we could find out that the browser send a request to the server by POST. The Request URL is https://newids.seu.edu.cn/authserver/login?goto=http://my.seu.edu.cn/index.portal.

   ![image-20210723214147570](/images/seu-login.assets/image-20210723214147570.png)

4. Check the Form Data, we can find out the structure of the posted formï¼ŒThe value of `username` is the Student ID, and the value of `password` is a encrypted password which might be generated by JavaScript code in the browser. After many trials, it was found that the values of `dllt`, `_eventId`, `rmShown` and other fields are all fixed values, while the values of `lt` and `execution` change everytime. Therefore, our task is to find out how `lt` and `execution` change and how the password is encrypted.![image-20210723214430798](/images/seu-login.assets/image-20210723214430798.png)

## Search the code of the web page for clues

1. Search for `lt`, `execution`, `password` and other fields in the login web page code and find that the form in the web page already contains these data, but they cannot be directly observed as the type is set to hidden. Therefore, we need to first access the login page to get these data.![image-20210723214740979](/images/seu-login.assets/image-20210723214740979.png)

2. In addition, we also found a `pwdDefaultEncryptSalt` item in the form, which we guess is most likely the key used for encryption. Continuing to use this field as a search keyword, a function call `encrypteAES` is found in the JavaScript file log-wisedu_v1.0.js:
   ![image-20210723215308842](/images/seu-login.assets/image-20210723215308842.png)

3. Check the code of the JavaScript file:
   ![image-20210723220052025](/images/seu-login.assets/image-20210723220052025.png)
   ![image-20210723220250030](/images/seu-login.assets/image-20210723220250030.png)

4. `pwdDefaultEncryptSalt` was passed as a parameter to another function `encryptAES`. We continued searching and found that an encrypt.js contained the definition of this function:
   ![image-20210723215738560](/images/seu-login.assets/image-20210723215738560.png)

5. At this point, the secret of the POST form has been revealed. Just use the `encryptAES` function in encrypt.js with the password and `pwdDefaultEncryptSalt` extracted from the web page code as parameters to get the encrypted password.

## Crawler programming

Import three packages: `requests`, `re`, `execjs`. First, create a session by requests.session() and request the login web page. Extract `pwdDefaultEncryptSalt`, `execution` and other fields from the page, and then call encrypt.js to obtain the encrypted password. Finally, use the obtained parameters to construct a POST form and send it to the server to log in successfully.
![image-20210723221525732](/images/seu-login.assets/image-20210723221525732.png)
